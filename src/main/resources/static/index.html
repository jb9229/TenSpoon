<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TenSpoon</title>
    <link type="text/css" rel="stylesheet" href="/webjars/bootstrap/3.3.5/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="main.css">

    <script src="/webjars/react/0.13.3/react.min.js"></script>
    <script src="/webjars/react/0.13.3/JSXTransformer.js"></script>
    <script src="/webjars/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>
    <!--<script type="text/jsx" src="main.js"></script>-->
    <div id="content">워딩</div>
    <button onclick="">Create User</button>

    <script type="text/jsx">
        var AccountForm = React.createClass({
            handleSubmit: function(e) {
                e.preventDefault();
                var email = React.findDOMNode(this.refs.email).value.trim();
                var password = React.findDOMNode(this.refs.password).value.trim();
                if (!password || !email) {
                    return;
                }
                this.props.onAccountSubmit({email: email, password: password});
                React.findDOMNode(this.refs.email).value = '';
                React.findDOMNode(this.refs.password).value = '';
                return;
            },
            render: function() {
                return (
                        <form className="accountForm">
                            <input type="email" placeholder="이메일" ref="email"/>
                            <input type="password" placeholder="패스워드" ref="password"/>
                            <input type="text" placeholder="사용자명" ref="username"/>


                            <input type="submit" value="올리기" />
                        </form>
                );
            }
        });

        var AccountBox  =   React.createClass({
           loadAccountsFromServer: function() {
               $.ajax({
                   url: this.props.url,
                   dataType: 'json',
                   cache: false,
                   success: function(data) {
                       this.setState({data: data.content});
                   }.bind(this),
                   error: function(xhr, status, err){
                       console.error(this.props.url, status, err.toString());
                   }.bind(this)
               });
           },
            getInitialState: function() {
                return {data: []};
            },
            componentDidMount: function() {
                this.loadAccountsFromServer();
                setInterval(this.loadAccountsFromServer, this.props.pollInterval);
            },
            render: function() {
                return (
                        <div className="accountBox">
                            <h1>사용자</h1>
                            <AccountList data={this.state.data} />
                        </div>
                );
            }
        });

        var AccountList =   React.createClass({
            render: function() {
                var accountNodes = this.props.data.map(function (account) {
                    return (
                            <Account email={account.email} username={account.username}>
                                {account.username}
                            </Account>
                    );
                });

                return (
                        <div className="accountList">
                            {accountNodes}
                        </div>
                );
            }
        });

        var Account     =   React.createClass({
            render: function() {
                return (
                        <div className="account">
                            <h2 className="accountEmail">
                                {this.props.email} / {this.props.username}
                            </h2>
                        </div>
                );
            }
        });

        React.render(
                <AccountBox url="/api/v1/accounts?email=jinbeomjeong@google.com&size=2" pollInterval={1800000} />,
                document.getElementById('content')
        );
    </script>
</body>
</html>